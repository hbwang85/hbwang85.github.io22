
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>KVC &amp; KVO - Henry Wang's Blog</title>
  <meta name="author" content="HaiBin Wang">

  
  <meta name="description" content="Background KVC is a fundamental technology when working with key-value observing, Cocoa bindings, Core Data and making your application AppleScript- &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hbwang85.github.io/blog/2015/07/20/kvc-and-kvo/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Henry Wang's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->
<!--link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"-->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Henry Wang's Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">KVC &amp; KVO</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-20T15:10:25+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:10 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Background</h2>

<p>KVC is a fundamental technology when working with key-value observing, Cocoa bindings, Core Data and making your application AppleScript-able. It&rsquo;s really powerful, But few know about the detail. Especially for the collection operators. As part of KVC, collection operators help make many routine tasks simple.</p>

<!--more-->


<p></p>

<h2>KVC Fundament</h2>

<p>Key-Value Coding is a mechanism for accessing an object&rsquo;s properties indirectly, useing strings to identify properties, rather than through invocation of an accessor method or accessing them directly through instnce variable. It is a fundamental technology when working with key-value observing, Cocoa bindings, Core Data and making your application AppleScript-able.</p>

<p>Simply We can get the value by invoking valueForKey:(valueForKeyPath). If there is no accessor or instance variable for the specified key, then the receiver sends itself a valueForUndefinedKey: message, and the default implementation of that message raises an NSUndefinedKeyException.</p>

<p>On the other hand, we can set the value of the specified key by invoking setValue: forKey:. If the specified key doesn&rsquo;t exist, the reveiver is sent a setValue:forUndefinedKey: message, and the message will raise an NSUndefinedKeyException.</p>

<p>The essential methods for key-value coding are declared in the NSKeyValueCoding Objective-C informal protocol and default implementations are provided by NSObject.</p>

<p>Key-value coding supports properties with object values, as well as the scalar types and structs. Non-object parameters and return types are detected and automatically wrapped, and unwrapped.</p>

<p>For scalar types, the instances will be wrapped to NSNumber instances，
<img class="center" src="/images/kvc/scalar1.png">
<img class="center" src="/images/kvc/scalar2.png"></p>

<p>For Struct，the instances will be wrapped as NSValue instances. Remember that NSValue and NSNumber both are inheritated from NSObject.<br/>
<img class="center" src="/images/kvc/struct.png"></p>

<p>when you access a property using the dot syntax, you invoke the receiver&rsquo;s standard accessor methods.</p>

<h2>Collection Operators</h2>

<p>Collection operators allow actions to be performed on the items of a collection using key path notation and an action operator. This article describes the available collection operators, example key paths, and the results they’d produce. The format is as below:</p>

<p><img class="center" src="/images/kvc/collection_operators_format.png"></p>

<p>Collection operators are specialized key paths that are passed as the parameter to the valueForKeyPath: method. The operator is specified by a string preceded by an at sign (@). The key path on the left side of the collection operator, if present, determines the array or set, relative to the receiver, that is used in the operation. The key path on the right side of the operator specifies the property of the collection that the operator uses. Figure 1 illustrates the operator key path format.</p>

<p>We can use it as below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[object valueForKeyPath:@"&lt;keypathToCollection&gt;.&lt;@collectionOperator&gt;.&lt;keypathToProperty&gt;"];</span></code></pre></td></tr></table></div></figure>


<p>This is the same as :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[[object valueForKeyPath:@"&lt;keypathToCollection&gt;"] valueForKeyPath:@"&lt;@collectionOperators&gt;.&lt;keypathToProperty&gt;"];
</span></code></pre></td></tr></table></div></figure>


<p>The obvious advantage is their consicion, but the big disadvantage is that we don’t get compile-time errors when we misuse them and nor do we get code-completion</p>

<p>The Desirables</p>

<p>Firstly, we should be explicit about what types of objects we expect to be in the collection. This should give us code-completion on the key path and an error if the key path doesn’t exist on objects of the pre-specified type.</p>

<p>Secondly, some collection operators demand that the key path leads to a specific type of object. For example, . In these cases, we should get a compile-time error if the key path leads to an object of an invalid type.</p>

<p>Finally, we should only be allowed to use the documented collection operators, and we should get compile-time errors if we try to use an undefined operator.</p>

<p>Collection Operators can be devided to 3 kinds:</p>

<h3>Simple Colletion Operators</h3>

<blockquote><p>@avg
@max
@min
@sum
@count</p></blockquote>

<p>Note:<br/>
1. If you&rsquo;d like to call @max or @min, the compared property objects must support comparison with each other;<br/>
2. For the @count, the keypath to the right of the operator is ignored. And the difference between @count and count method are as below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[@[@"a",@"b"] count]
</span><span class='line'>    // -&gt; 2
</span><span class='line'>[@[@"a",@"b"] valueForKey:@"@count"]
</span><span class='line'>    // -&gt; @(2)
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>Object Operators</h3>

<blockquote><p>@distinctUnionOfObjects
@unionOfObjects</p></blockquote>

<p>Note:<br/>
1. @unionOfObjects, is basically useless,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[object valueForKeypath:@"@unionOfObjects.&lt;keypathToProperty&gt;"];  </span></code></pre></td></tr></table></div></figure>


<p>is exactly the same as :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[object valueForKey:@"&lt;keypathToProperty&gt;"];</span></code></pre></td></tr></table></div></figure>


<h3>Array and Set Operators</h3>

<blockquote><p>@unionOfArray
@distinctUnionOfArrays
@distinctUnionOfSet</p></blockquote>

<h3>KVC + self = perfect</h3>

<p>You can use self as the <keypathToProperty>. for example, if you&rsquo;d like to flatten a array as below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[@[@[@(1),@(2),@(3)]] valueForKeyPath:@"@unionOfArray.self"];
</span><span class='line'>       // @[@(1),@(2),@(3)]</span></code></pre></td></tr></table></div></figure>


<p>
If the wrap lever is more than one, e.g. 2, you can flatten it as below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[@[@[@[@(1),@(2),@(3)]]] valueForKeyPath:@"@unionOfArray.self.@unionOfArray.self"];
</span><span class='line'>       // @[@(1),@(2),@(3)]
</span><span class='line'>       // the first "@unionOfArray.self" is used as &lt;keypathToCollection&gt;</span></code></pre></td></tr></table></div></figure>


<h2>Reference</h2>

<ol>
<li>Key-Value Coding Programming Guide</li>
<li><a href="http://bou.io/KVCCustomOperators.html">http://bou.io/KVCCustomOperators.html</a></li>
</ol>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">HaiBin Wang</span></span>

      




<time class='entry-date' datetime='2015-07-20T15:10:25+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:10 pm</span></time>
      


    </p>
    
      <div class="sharing">
  

  
  
  
  
  
    <!--jiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

<!-- UY BEGIN -->
<div></div>>
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2036136"></script>
<!-- UY END -->

  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/07/19/test-driven-development/" title="Previous Post: Test Driven Development">&laquo; Test Driven Development</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>A little something about me.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/20/kvc-and-kvo/">KVC &amp; KVO</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/19/test-driven-development/">Test Driven Development</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/25/reactivecocoa-notes/">ReactiveCocoa Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/16/storyboard-for-tableview/">Storyboard for Tableview</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/11/how-to-edit-git-ignore-file/">How to Edit Gitignore File for Xcode Project</a>
      </li>
    
  </ul>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div class="list-group">
    
  </div>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - HaiBin Wang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
